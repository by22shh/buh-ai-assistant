# üîí –ü–û–õ–ù–´–ô –ê–£–î–ò–¢ –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò –ò –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–ò

**–î–∞—Ç–∞ –∞—É–¥–∏—Ç–∞:** 2025-01-28  
**–ê—É–¥–∏—Ç–æ—Ä:** Senior Security Engineer  
**–í–µ—Ä—Å–∏—è —Å–∏—Å—Ç–µ–º—ã:** Production-ready  
**–ú–µ—Ç–æ–¥ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:** Email OTP + JWT —Ç–æ–∫–µ–Ω—ã

---

## üìä –ò–°–ü–û–õ–¨–ó–£–ï–ú–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê

### –ú–µ—Ç–æ–¥ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- **–¢–∏–ø:** Email-based –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ –∫–æ–¥—ã (OTP) + JWT —Ç–æ–∫–µ–Ω—ã
- **Flow:** Email ‚Üí OTP –∫–æ–¥ (10 –º–∏–Ω) ‚Üí JWT Access Token (15 –º–∏–Ω) + Refresh Token (7 –¥–Ω–µ–π)
- **–•—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤:** HTTP-only cookies —Å `SameSite=strict`
- **Middleware:** Next.js middleware –¥–ª—è –∑–∞—â–∏—Ç—ã –≤—Å–µ—Ö API endpoints
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** PostgreSQL (Prisma ORM)
- **Rate limiting:** Upstash Redis (—Å fallback mock)

---

## üìã –ò–¢–û–ì–û–í–ê–Ø –¢–ê–ë–õ–ò–¶–ê –†–ï–ó–£–õ–¨–¢–ê–¢–û–í

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ü—Ä–æ–≤–µ—Ä–∫–∞ | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π / –†–∏—Å–∫ |
|-----------|----------|--------|-------------------|
| **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** | –ú–µ—Ç–æ–¥ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ | ‚úÖ | Email OTP + JWT - –±–µ–∑–æ–ø–∞—Å–Ω–æ |
| **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** | –ó–∞—â–∏—Ç–∞ API endpoints | ‚úÖ | Middleware –∑–∞—â–∏—â–∞–µ—Ç –≤—Å–µ `/api/*` |
| **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** | –ü—É–±–ª–∏—á–Ω—ã–µ –ø—É—Ç–∏ | ‚úÖ | –¢–æ–ª—å–∫–æ `/api/auth/*` –ø—É–±–ª–∏—á–Ω—ã–µ |
| **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è frontend-backend | ‚úÖ | Cookies —Å `credentials: 'include'` |
| **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è** | –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | ‚úÖ | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —á–µ—Ä–µ–∑ `upsertUser` |
| **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è** | –í–∞–ª–∏–¥–∞—Ü–∏—è email | ‚úÖ | Regex –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ |
| **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è** | Rate limit –≤—Ö–æ–¥–æ–≤ | ‚ö†Ô∏è | –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å Upstash Redis |
| **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è** | –ó–∞—â–∏—Ç–∞ –æ—Ç user enumeration | ‚úÖ | –í—Å–µ–≥–¥–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –æ—Ç–≤–µ—Ç |
| **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è** | –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∫–æ–¥–∞ | ‚úÖ | 10 –º–∏–Ω—É—Ç, –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ |
| **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è** | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞ | ‚úÖ | Crypto.randomBytes, 6 —Ü–∏—Ñ—Ä |
| **–¢–æ–∫–µ–Ω—ã** | Access token TTL | ‚úÖ | 15 –º–∏–Ω—É—Ç - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ |
| **–¢–æ–∫–µ–Ω—ã** | Refresh token TTL | ‚úÖ | 7 –¥–Ω–µ–π - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ |
| **–¢–æ–∫–µ–Ω—ã** | –•—Ä–∞–Ω–µ–Ω–∏–µ –≤ HTTP-only | ‚úÖ | –ó–∞—â–∏—Ç–∞ –æ—Ç XSS |
| **–¢–æ–∫–µ–Ω—ã** | SameSite cookie | ‚úÖ | Strict - –∑–∞—â–∏—Ç–∞ –æ—Ç CSRF |
| **–¢–æ–∫–µ–Ω—ã** | Secure flag | ‚úÖ | –¢–æ–ª—å–∫–æ –≤ production |
| **–¢–æ–∫–µ–Ω—ã** | Refresh flow | ‚úÖ | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤ api-client |
| **–¢–æ–∫–µ–Ω—ã** | –†–æ—Ç–∞—Ü–∏—è refresh | ‚úÖ | –í–∫–ª—é—á–µ–Ω–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é |
| **–¢–æ–∫–µ–Ω—ã** | –û—Ç–∑—ã–≤ –ø—Ä–∏ logout | ‚úÖ | –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ |
| **–¢–æ–∫–µ–Ω—ã** | –í–∞–ª–∏–¥–∞—Ü–∏—è –≤ –ë–î | ‚úÖ | –ü—Ä–æ–≤–µ—Ä–∫–∞ revoked —Ñ–ª–∞–≥–∞ |
| **–¢–æ–∫–µ–Ω—ã** | –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –ë–î | ‚úÖ | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ –ø—Ä–∏ refresh |
| **–†–æ–ª–∏** | –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ middleware | ‚úÖ | –î–ª—è `/api/admin/*` |
| **–†–æ–ª–∏** | –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ API routes | ‚úÖ | –î–≤–æ–π–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ |
| **–†–æ–ª–∏** | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–æ–ª–µ–π | ‚úÖ | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ |
| **–†–æ–ª–∏** | –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ | ‚úÖ | –ß–µ—Ä–µ–∑ middleware + API |
| **–û—à–∏–±–∫–∏** | –ö–æ–¥—ã –æ—Ç–≤–µ—Ç–æ–≤ | ‚úÖ | 400, 401, 403, 404, 409, 429, 500 |
| **–û—à–∏–±–∫–∏** | –°–æ–æ–±—â–µ–Ω–∏—è auth | ‚úÖ | –ù–µ —Ä–∞–∑–ª–∏—á–∞—é—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ email |
| **–û—à–∏–±–∫–∏** | Stack trace –≤ –æ—Ç–≤–µ—Ç–∞—Ö | ‚úÖ | –ù–µ—Ç (Next.js —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç) |
| **–û—à–∏–±–∫–∏** | –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è | ‚úÖ | –û–¥–∏–Ω–∞–∫–æ–≤—ã–µ –¥–ª—è –≤—Å–µ—Ö —Å–ª—É—á–∞–µ–≤ |
| **–õ–æ–≥–∏** | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ö–æ–¥–æ–≤ | ‚ùå | –ù–µ—Ç –∞—É–¥–∏—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è |
| **–õ–æ–≥–∏** | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã—Ö–æ–¥–æ–≤ | ‚ùå | –ù–µ—Ç –∞—É–¥–∏—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è |
| **–õ–æ–≥–∏** | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ | ‚ö†Ô∏è | –¢–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Upstash rate limit |
| **–õ–æ–≥–∏** | –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å | ‚ùå | –ù–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ |
| **–õ–æ–≥–∏** | –ü–∞—Ä–æ–ª–∏ –≤ –ª–æ–≥–∞—Ö | ‚úÖ | –ù–µ—Ç (–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–æ–¥—ã) |
| **–õ–æ–≥–∏** | –¢–æ–∫–µ–Ω—ã –≤ –ª–æ–≥–∞—Ö | ‚úÖ | –ù–µ—Ç —Ç–æ–∫–µ–Ω–æ–≤ –≤ –ª–æ–≥–∞—Ö |
| **UX** | –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–≤–µ—Ä–Ω–æ–≥–æ –∫–æ–¥–∞ | ‚úÖ | –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ |
| **UX** | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π refresh | ‚úÖ | –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ api-client |
| **UX** | Retry –ø—Ä–∏ 401 | ‚úÖ | –ü–æ–ø—ã—Ç–∫–∞ refresh –ø–µ—Ä–µ–¥ —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–º |
| **UX** | –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å—Ç–µ–∫—à–µ–≥–æ —Ç–æ–∫–µ–Ω–∞ | ‚úÖ | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π refresh |
| **UX** | –ö–Ω–æ–ø–∫–∏ –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ | ‚úÖ | Disabled —Å–æ—Å—Ç–æ—è–Ω–∏–µ |
| **UX** | –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å–µ—Ç–∏ | ‚úÖ | Try-catch –Ω–∞ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö |
| **XSS** | HTTP-only cookies | ‚úÖ | –¢–æ–∫–µ–Ω—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –∏–∑ JS |
| **XSS** | Content Security Policy | ‚ùì | –ù–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ —è–≤–Ω–æ |
| **XSS** | Input sanitization | ‚ö†Ô∏è | –ù—É–∂–Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ |
| **CSRF** | SameSite=strict | ‚úÖ | –•–æ—Ä–æ—à–∞—è –∑–∞—â–∏—Ç–∞ |
| **CSRF** | CSRF —Ç–æ–∫–µ–Ω—ã | ‚ùå | –ù–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∑–∞—â–∏—Ç—ã |
| **CSRF** | Referer –ø—Ä–æ–≤–µ—Ä–∫–∞ | ‚ùå | –ù–µ—Ç |
| **Session** | –†–æ—Ç–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤ –ø—Ä–∏ –≤—Ö–æ–¥–µ | ‚úÖ | –ù–æ–≤—ã–π —Ç–æ–∫–µ–Ω –∫–∞–∂–¥—ã–π —Ä–∞–∑ |
| **Session** | Session fixation –∑–∞—â–∏—Ç–∞ | ‚úÖ | –ù–æ–≤—ã–µ —Ç–æ–∫–µ–Ω—ã –ø—Ä–∏ –≤—Ö–æ–¥–µ |
| **Rate Limit** | –î–ª—è auth endpoints | ‚ö†Ô∏è | –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å Upstash |
| **Rate Limit** | –î–ª—è API | ‚ö†Ô∏è | –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å Upstash |
| **Rate Limit** | Fallback limiter | ‚ö†Ô∏è | Mock (–≤—Å–µ–≥–¥–∞ —Ä–∞–∑—Ä–µ—à–∞–µ—Ç) |

---

## üîç –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó

### 1. –û–ë–©–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê ‚úÖ

#### –ú–µ—Ç–æ–¥ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- **–¢–∏–ø:** Email OTP (–æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ –∫–æ–¥—ã) + JWT —Ç–æ–∫–µ–Ω—ã
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** Stateless —Å refresh —Ç–æ–∫–µ–Ω–∞–º–∏
- **–ü—Ä–æ—Ü–µ—Å—Å:**
  1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç email
  2. –°–µ—Ä–≤–µ—Ä –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥ (10 –º–∏–Ω TTL)
  3. –ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ email —á–µ—Ä–µ–∑ SMTP
  4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –∫–æ–¥
  5. –í—ã–¥–∞—ë—Ç—Å—è Access Token (15 –º–∏–Ω) + Refresh Token (7 –¥–Ω–µ–π)

#### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- **Frontend ‚Üí Backend:** Cookies –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ `credentials: 'include'`
- **Middleware:** –ü—Ä–æ–≤–µ—Ä—è–µ—Ç JWT –Ω–∞ –≤—Å–µ—Ö `/api/*` endpoints
- **API Routes:** –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ `getCurrentUser()`

#### –ó–∞—â–∏—Ç–∞ endpoints
```typescript
// src/middleware.ts:7-11
const PUBLIC_PATHS = [
  '/api/auth/send-code',
  '/api/auth/verify-code',
  '/api/auth/refresh',
];
```
‚úÖ –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø—É—Ç–∏ –∑–∞—â–∏—â–µ–Ω—ã middleware

**–ü—Ä–æ–±–ª–µ–º—ã:** –ù–µ—Ç

---

### 2. –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø –ò –í–•–û–î ‚úÖ

#### –®–∞–≥ 1: –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–¥–∞ (`/api/auth/send-code`)

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
// src/app/api/auth/send-code/route.ts
// ‚úÖ Rate limiting –ø–µ—Ä–µ–¥ –ø–∞—Ä—Å–∏–Ω–≥–æ–º body
// ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è email —Ñ–æ—Ä–º–∞—Ç–∞
// ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞ —á–µ—Ä–µ–∑ crypto.randomBytes
// ‚úÖ –í—Å–µ–≥–¥–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –æ—Ç–≤–µ—Ç (–∑–∞—â–∏—Ç–∞ –æ—Ç user enumeration)
// ‚úÖ –ë–∞–∑–æ–≤–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è timing attacks
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- ‚úÖ Rate limit: 5 –ø–æ–ø—ã—Ç–æ–∫ –≤ –º–∏–Ω—É—Ç—É (—Ç–æ–ª—å–∫–æ —Å Upstash)
- ‚úÖ Email –≤–∞–ª–∏–¥–∞—Ü–∏—è: Regex `/^[^\s@]+@[^\s@]+\.[^\s@]+$/`
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞: `Math.floor(100000 + Math.random() * 900000)`
- ‚úÖ –í—Ä–µ–º—è –∂–∏–∑–Ω–∏: 10 –º–∏–Ω—É—Ç
- ‚úÖ –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–µ–∫—à–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- ‚úÖ **–ó–∞—â–∏—Ç–∞ –æ—Ç user enumeration:** –í—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `success: true`, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è email
- ‚úÖ **Timing attack –∑–∞—â–∏—Ç–∞:** –ë–∞–∑–æ–≤–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ 500ms
- ‚úÖ **–ö–æ–¥ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ production:** –¢–æ–ª—å–∫–æ –≤ dev —Ä–µ–∂–∏–º–µ

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ö†Ô∏è **Rate limiting —Ç–æ–ª—å–∫–æ —Å Upstash:** –ë–µ–∑ Redis rate limit –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (mock –≤—Å–µ–≥–¥–∞ —Ä–∞–∑—Ä–µ—à–∞–µ—Ç)

#### –®–∞–≥ 2: –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–æ–¥–∞ (`/api/auth/verify-code`)

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
// src/app/api/auth/verify-code/route.ts
// ‚úÖ Rate limiting
// ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ –≤ –ë–î
// ‚úÖ Mark as used –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
// ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
// ‚úÖ –í—ã–¥–∞—á–∞ —Ç–æ–∫–µ–Ω–æ–≤ –≤ cookies
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- ‚úÖ Rate limit: 5 –ø–æ–ø—ã—Ç–æ–∫ –≤ –º–∏–Ω—É—Ç—É
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞: –ü–æ email + code + not used + not expired
- ‚úÖ –ü–æ–º–µ—Ç–∫–∞ –∫–∞–∫ used: –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- ‚úÖ Upsert –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- ‚úÖ –ù–µ —Ä–∞–∑–ª–∏—á–∞–µ—Ç—Å—è "–Ω–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥" –∏ "–∫–æ–¥ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç" - —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
- ‚úÖ –ö–æ–¥ –Ω–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–≤–∞–∂–¥—ã
- ‚úÖ –ò—Å—Ç–µ–∫—à–∏–µ –∫–æ–¥—ã —É–¥–∞–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

**–ü—Ä–æ–±–ª–µ–º—ã:** –ù–µ—Ç

---

### 3. –¢–û–ö–ï–ù–´ –ò –°–ï–°–°–ò–ò ‚úÖ

#### Access Token

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- ‚úÖ –í—Ä–µ–º—è –∂–∏–∑–Ω–∏: 15 –º–∏–Ω—É—Ç (–∫–æ—Ä–æ—Ç–∫–∏–π TTL)
- ‚úÖ –•—Ä–∞–Ω–µ–Ω–∏–µ: HTTP-only cookie
- ‚úÖ SameSite: `strict` (–∑–∞—â–∏—Ç–∞ –æ—Ç CSRF)
- ‚úÖ Secure flag: –¢–æ–ª—å–∫–æ –≤ production
- ‚úÖ –ê–ª–≥–æ—Ä–∏—Ç–º: HS256 (JWT)

```typescript
// src/lib/jwt.ts:72-87
const cookieOptions = {
  httpOnly: true,
  secure: isProduction, // HTTPS —Ç–æ–ª—å–∫–æ –Ω–∞ production
  sameSite: 'strict' as const,
  maxAge: 60 * 15, // 15 –º–∏–Ω—É—Ç
  path: '/',
};
```

#### Refresh Token

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- ‚úÖ –í—Ä–µ–º—è –∂–∏–∑–Ω–∏: 7 –¥–Ω–µ–π (–∞–¥–µ–∫–≤–∞—Ç–Ω—ã–π TTL)
- ‚úÖ –•—Ä–∞–Ω–µ–Ω–∏–µ: HTTP-only cookie + –ë–î
- ‚úÖ –†–æ—Ç–∞—Ü–∏—è: –í–∫–ª—é—á–µ–Ω–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- ‚úÖ –û—Ç–∑—ã–≤ –ø—Ä–∏ logout: ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤ –ë–î: –ü—Ä–æ–≤–µ—Ä–∫–∞ `revoked` —Ñ–ª–∞–≥–∞

```typescript
// src/app/api/auth/refresh/route.ts:62
const shouldRotateRefresh = process.env.ROTATE_REFRESH_TOKENS !== 'false';
// ‚úÖ –†–æ—Ç–∞—Ü–∏—è –≤–∫–ª—é—á–µ–Ω–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
```

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å refresh flow:**
1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ JWT –ø–æ–¥–ø–∏—Å–∏ refresh —Ç–æ–∫–µ–Ω–∞
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î (—Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ, –Ω–µ revoked, –Ω–µ expired)
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ä–æ–ª–∏/email —Å –ë–î
4. ‚úÖ –û—Ç–∑—ã–≤ —Å—Ç–∞—Ä–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ –ø—Ä–∏ —Ä–æ—Ç–∞—Ü–∏–∏

#### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π Refresh Flow

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
// src/lib/api-client.ts:8-51
async function attemptTokenRefresh(): Promise<boolean> {
  // –ó–∞—â–∏—Ç–∞ –æ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤
  if (isRefreshing && refreshPromise) {
    // –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ refresh
  }
  // –í—ã–∑—ã–≤–∞–µ–º /api/auth/refresh
}
```

**–û–±—Ä–∞–±–æ—Ç–∫–∞ 401:**
```typescript
// src/lib/api-client.ts:74-82
if (response.status === 401 && !isRetry) {
  const refreshSuccess = await attemptTokenRefresh();
  if (refreshSuccess) {
    // –ü–æ–≤—Ç–æ—Ä—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å
    return apiClient<T>(url, options, true);
  }
}
```

‚úÖ **–û—Ç–ª–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π refresh –ø—Ä–∏ 401, –∑–∞—â–∏—Ç–∞ –æ—Ç —Ü–∏–∫–ª–æ–≤

**–ü—Ä–æ–±–ª–µ–º—ã:** –ù–µ—Ç

---

### 4. –†–û–õ–ò –ò –ü–†–ê–í–ê ‚úÖ

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–µ–π

**Middleware:**
```typescript
// src/middleware.ts:135-142
if (ADMIN_PATHS.some(path => pathname.startsWith(path))) {
  if (payload.role !== 'admin') {
    return NextResponse.json(
      { error: 'Forbidden', message: 'Admin access required' },
      { status: 403 }
    );
  }
}
```

**API Routes:**
```typescript
// src/app/api/admin/templates/[code]/route.ts:15-16
if (!user) return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
if (user.role !== 'admin') return NextResponse.json({ error: 'Admin access required' }, { status: 403 });
```

‚úÖ **–î–≤–æ–π–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:** Middleware + API route

#### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–æ–ª–µ–π

```typescript
// src/lib/auth-utils.ts:64-73
const adminEmail = process.env.ADMIN_EMAIL;
const isAdmin = adminEmail ? email.toLowerCase() === adminEmail.toLowerCase() : false;

const user = await prisma.user.upsert({
  // ...
  role: isAdmin ? 'admin' : 'user',
});
```

‚úÖ –†–æ–ª—å –Ω–∞–∑–Ω–∞—á–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –ë–î

```typescript
// src/app/api/auth/refresh/route.ts:44-51
if (user.email !== payload.email || user.role !== payload.role) {
  // –û—Ç–∑—ã–≤–∞–µ–º –≤—Å–µ —Ç–æ–∫–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å
  await revokeRefreshToken(refreshTokenValue);
  return NextResponse.json(
    { error: 'Unauthorized', message: 'User data changed, please login again' },
    { status: 401 }
  );
}
```

‚úÖ –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–æ–ª–∏ –≤—Å–µ —Ç–æ–∫–µ–Ω—ã –æ—Ç–∑—ã–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

**–ü—Ä–æ–±–ª–µ–º—ã:** –ù–µ—Ç

---

### 5. –û–®–ò–ë–ö–ò –ò –ò–°–ö–õ–Æ–ß–ï–ù–ò–Ø ‚úÖ

#### –ö–æ–¥—ã –æ—Ç–≤–µ—Ç–æ–≤

| –ö–æ–¥ | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ | –°—Ç–∞—Ç—É—Å |
|-----|---------------|--------|
| 400 | –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö | ‚úÖ |
| 401 | Unauthorized (–Ω–µ—Ç —Ç–æ–∫–µ–Ω–∞ –∏–ª–∏ –∏—Å—Ç–µ–∫) | ‚úÖ |
| 403 | Forbidden (–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤) | ‚úÖ |
| 404 | Not Found | ‚úÖ |
| 409 | Conflict (email —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è) | ‚úÖ |
| 429 | Rate Limit –ø—Ä–µ–≤—ã—à–µ–Ω | ‚úÖ |
| 500 | Internal Server Error | ‚úÖ |

#### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–æ–≤:**
```typescript
// –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
{ 
  success: boolean,
  error?: string,
  message?: string 
}
```

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–π:**
- ‚úÖ –ù–µ —Ä–∞–∑–ª–∏—á–∞–µ—Ç—Å—è "–Ω–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥" –∏ "–∫–æ–¥ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
- ‚úÖ –í—Å–µ–≥–¥–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –æ—Ç–≤–µ—Ç –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–æ–¥–∞ (–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è email)
- ‚úÖ –ù–µ—Ç —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –æ—Ç–≤–µ—Ç–∞—Ö (–∫–æ–¥—ã, —Ç–æ–∫–µ–Ω—ã, –ø–∞—Ä–æ–ª–∏)

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```typescript
// src/app/api/users/me/route.ts:25
console.error('GET /api/users/me error:', error);
```
‚ö†Ô∏è **–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** –í production Next.js –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç stack trace, –Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ö†Ô∏è **Console.error —Å –ø–æ–ª–Ω—ã–º –æ–±—ä–µ–∫—Ç–æ–º error:** –ú–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –ª–æ–≥–∞—Ö
- ‚úÖ **Stack trace –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫–ª–∏–µ–Ω—Ç—É:** Next.js —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç

---

### 6. –õ–û–ì–ò –ò –ê–£–î–ò–¢ ‚ùå

#### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

| –ü—Ä–æ–≤–µ—Ä–∫–∞ | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|----------|--------|-------------|
| –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ö–æ–¥–æ–≤ | ‚ùå | –ù–µ—Ç |
| –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã—Ö–æ–¥–æ–≤ | ‚ùå | –ù–µ—Ç |
| –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ | ‚ö†Ô∏è | –¢–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Upstash rate limit |
| –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å | ‚ùå | –ù–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ |
| –•—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π –≤ –ª–æ–≥–∞—Ö | ‚úÖ | –ù–µ—Ç –ø–∞—Ä–æ–ª–µ–π (–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–æ–¥—ã) |
| –•—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –≤ –ª–æ–≥–∞—Ö | ‚úÖ | –ù–µ—Ç —Ç–æ–∫–µ–Ω–æ–≤ –≤ –ª–æ–≥–∞—Ö |

#### –ü—Ä–æ–±–ª–µ–º—ã

1. **‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∞—É–¥–∏—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –ù–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —É—Å–ø–µ—à–Ω—ã—Ö –≤—Ö–æ–¥–æ–≤
   - –ù–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ—É—Å–ø–µ—à–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞
   - –ù–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤—ã—Ö–æ–¥–æ–≤
   - –ù–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ (—Ö–æ—Ç—è –µ—Å—Ç—å `AccessHistory` –≤ –ë–î)

2. **‚ùå –ù–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏**
   - –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ 401 –æ—à–∏–±–∫–∏
   - –ë—ã—Å—Ç—Ä–∞—è —Å–º–µ–Ω–∞ IP –∞–¥—Ä–µ—Å–æ–≤
   - –ò–∑–º–µ–Ω–µ–Ω–∏—è —Ä–æ–ª–µ–π

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –≤—Ö–æ–¥–æ–≤/–≤—ã—Ö–æ–¥–æ–≤ –≤ –ë–î –∏–ª–∏ –≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å
- –î–æ–±–∞–≤–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –Ω–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î

---

### 7. UX-–ü–û–í–ï–î–ï–ù–ò–ï ‚úÖ

#### –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π

| –°–æ—Å—Ç–æ—è–Ω–∏–µ | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|-----------|--------|-------------|
| –ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥ | ‚úÖ | –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ |
| –ò—Å—Ç–µ–∫—à–∏–π —Ç–æ–∫–µ–Ω | ‚úÖ | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π refresh |
| –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π logout | ‚úÖ | –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ refresh –Ω–µ —É–¥–∞–ª—Å—è |
| –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ | ‚úÖ | –ü—Ä–æ–∑—Ä–∞—á–Ω–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| –ö–Ω–æ–ø–∫–∏ –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ | ‚úÖ | Disabled —Å–æ—Å—Ç–æ—è–Ω–∏–µ |

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π refresh:**
```typescript
// src/lib/api-client.ts:74-91
if (response.status === 401 && !isRetry) {
  const refreshSuccess = await attemptTokenRefresh();
  if (refreshSuccess) {
    return apiClient<T>(url, options, true); // Retry
  }
}
// –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ refresh –Ω–µ —É–¥–∞–ª—Å—è - —Ä–µ–¥–∏—Ä–µ–∫—Ç
window.location.href = '/auth/login';
```

‚úÖ **–û—Ç–ª–∏—á–Ω–æ:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —Ç–µ—Ä—è–µ—Ç —Å–µ—Å—Å–∏—é –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ access token

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
```typescript
// src/app/auth/login/page.tsx:98-100
if (!data.success) {
  throw new Error(data.error || '–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥');
}
// –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ toast
toast.error(err.message);
```

‚úÖ –ß–µ—Ç–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

**–ü—Ä–æ–±–ª–µ–º—ã:** –ù–µ—Ç

---

### 8. –£–Ø–ó–í–ò–ú–û–°–¢–ò

#### XSS (Cross-Site Scripting)

| –ó–∞—â–∏—Ç–∞ | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|--------|--------|-------------|
| HTTP-only cookies | ‚úÖ | –¢–æ–∫–µ–Ω—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –∏–∑ JavaScript |
| Content Security Policy | ‚ùì | –ù–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ —è–≤–Ω–æ –≤ –∫–æ–Ω—Ñ–∏–≥–µ |
| Input sanitization | ‚ö†Ô∏è | –ù—É–∂–Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ |

‚úÖ **–•–æ—Ä–æ—à–æ:** –¢–æ–∫–µ–Ω—ã –≤ HTTP-only cookies –∑–∞—â–∏—â–∞—é—Ç –æ—Ç XSS

‚ö†Ô∏è **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å CSP headers –∏ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—é input –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ

#### CSRF (Cross-Site Request Forgery)

| –ó–∞—â–∏—Ç–∞ | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|--------|--------|-------------|
| SameSite=strict | ‚úÖ | –•–æ—Ä–æ—à–∞—è –∑–∞—â–∏—Ç–∞ |
| CSRF —Ç–æ–∫–µ–Ω—ã | ‚ùå | –ù–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∑–∞—â–∏—Ç—ã |
| Referer –ø—Ä–æ–≤–µ—Ä–∫–∞ | ‚ùå | –ù–µ—Ç |

‚úÖ **–•–æ—Ä–æ—à–æ:** SameSite=strict –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ö–æ—Ä–æ—à—É—é –∑–∞—â–∏—Ç—É –æ—Ç CSRF –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å–ª—É—á–∞–µ–≤

‚ö†Ô∏è **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (–∏–∑–º–µ–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö, —É–¥–∞–ª–µ–Ω–∏–µ) –¥–æ–±–∞–≤–∏—Ç—å CSRF —Ç–æ–∫–µ–Ω—ã

#### Session Fixation

| –ó–∞—â–∏—Ç–∞ | –°—Ç–∞—Ç—É—Å |
|--------|--------|
| –†–æ—Ç–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤ –ø—Ä–∏ –≤—Ö–æ–¥–µ | ‚úÖ |
| –ù–æ–≤—ã–π —Ç–æ–∫–µ–Ω –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤—Ö–æ–¥–µ | ‚úÖ |

‚úÖ **–û—Ç–ª–∏—á–Ω–æ:** –ü—Ä–∏ –∫–∞–∂–¥–æ–º –≤—Ö–æ–¥–µ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –Ω–æ–≤—ã–µ —Ç–æ–∫–µ–Ω—ã

#### Token Storage

| –ú–µ—Å—Ç–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|----------------|--------|-------------|
| localStorage | ‚ùå | –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è |
| sessionStorage | ‚ùå | –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è |
| HTTP-only cookies | ‚úÖ | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è |
| Memory | ‚úÖ | React Query –∫–µ—à (—Ç–æ–ª—å–∫–æ user data) |

‚úÖ **–û—Ç–ª–∏—á–Ω–æ:** –¢–æ–∫–µ–Ω—ã —Ç–æ–ª—å–∫–æ –≤ HTTP-only cookies

#### –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º

| –ü–æ–ª–µ | –í–∞–ª–∏–¥–∞—Ü–∏—è | –°—Ç–∞—Ç—É—Å |
|------|-----------|--------|
| Email | Regex + Zod schema | ‚úÖ |
| –ö–æ–¥ | 6 —Ü–∏—Ñ—Ä + –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î | ‚úÖ |
| –î—Ä—É–≥–∏–µ –ø–æ–ª—è | Zod schemas | ‚úÖ |

‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ –∏ –±—ç–∫–µ–Ω–¥–µ

---

## üö® –ö–†–ò–¢–ò–ß–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∞—É–¥–∏—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–†–∏—Å–∫:** –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å:
- –ö—Ç–æ –∏ –∫–æ–≥–¥–∞ –≤—Ö–æ–¥–∏–ª –≤ —Å–∏—Å—Ç–µ–º—É
- –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```typescript
// –î–æ–±–∞–≤–∏—Ç—å –≤ /api/auth/verify-code –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
await prisma.authLog.create({
  data: {
    userId: user.id,
    email: user.email,
    ip: getIP(request),
    action: 'login',
    success: true,
  },
});

// –î–æ–±–∞–≤–∏—Ç—å –≤ /api/auth/logout
await prisma.authLog.create({
  data: {
    userId: user.id,
    email: user.email,
    ip: getIP(request),
    action: 'logout',
    success: true,
  },
});
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°—Ä–µ–¥–Ω–∏–π (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è —Ä–∞–±–æ—Ç—ã, –Ω–æ –≤–∞–∂–Ω–æ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)

---

## ‚ö†Ô∏è –°–†–ï–î–ù–ò–ï –ü–†–û–ë–õ–ï–ú–´

### ‚ö†Ô∏è Rate limiting —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å Upstash

**–†–∏—Å–∫:** –ë–µ–∑ Redis rate limit –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (mock –≤—Å–µ–≥–¥–∞ —Ä–∞–∑—Ä–µ—à–∞–µ—Ç)

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
// src/lib/rate-limit.ts:79-83
export async function checkApiRateLimit(identifier: string) {
  if (!apiLimiter) {
    console.warn('[Rate Limit] Upstash –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É');
    return mockLimiter.limit(); // –í—Å–µ–≥–¥–∞ —Ä–∞–∑—Ä–µ—à–∞–µ—Ç
  }
}
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å in-memory rate limiter –∫–∞–∫ fallback:
```typescript
// In-memory rate limiter —Å LRU –∫–µ—à–µ–º
import { LRUCache } from 'lru-cache';

const memoryLimiter = new LRUCache<string, { count: number; resetTime: number }>({
  max: 10000,
  ttl: 60000, // 1 –º–∏–Ω—É—Ç–∞
});

export async function checkApiRateLimit(identifier: string) {
  if (!apiLimiter) {
    // In-memory fallback
    const key = `rate:${identifier}`;
    const current = memoryLimiter.get(key) || { count: 0, resetTime: Date.now() + 60000 };
    
    if (Date.now() > current.resetTime) {
      current.count = 0;
      current.resetTime = Date.now() + 60000;
    }
    
    if (current.count >= 100) {
      return { success: false, limit: 100, remaining: 0, reset: current.resetTime };
    }
    
    current.count++;
    memoryLimiter.set(key, current);
    
    return { success: true, limit: 100, remaining: 100 - current.count, reset: current.resetTime };
  }
  
  return await apiLimiter.limit(identifier);
}
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°—Ä–µ–¥–Ω–∏–π

---

### ‚ö†Ô∏è Console.error –º–æ–∂–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

**–†–∏—Å–∫:** –í production –ª–æ–≥–∏ –º–æ–≥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å stack traces –∏–ª–∏ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
console.error('GET /api/users/me error:', error);
// –ú–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å stack trace —Å —Ñ–∞–π–ª–∞–º–∏, –ø—É—Ç—è–º–∏, –¥–∞–Ω–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```typescript
// –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
console.error('GET /api/users/me error:', {
  message: error instanceof Error ? error.message : 'Unknown error',
  code: error instanceof Error && 'code' in error ? error.code : undefined,
  // –ù–ï –ª–æ–≥–∏—Ä—É–µ–º: stack, request body, tokens, passwords
});
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ù–∏–∑–∫–∏–π (Next.js —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç stack trace –≤ –æ—Ç–≤–µ—Ç–∞—Ö)

---

## üí° –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –£–õ–£–ß–®–ï–ù–ò–Æ

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–í–∞–∂–Ω–æ)

1. ‚úÖ **–î–æ–±–∞–≤–∏—Ç—å –∞—É–¥–∏—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –≤—Ö–æ–¥–æ–≤/–≤—ã—Ö–æ–¥–æ–≤
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–æ—Å—Ç—É–ø–∞
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î (`AuthLog` —Ç–∞–±–ª–∏—Ü–∞)

2. ‚úÖ **In-memory rate limiter fallback**
   - –î–æ–±–∞–≤–∏—Ç—å LRU –∫–µ—à –¥–ª—è rate limiting
   - –†–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ)

1. ‚úÖ **Content Security Policy headers**
   ```typescript
   // next.config.js
   headers: async () => [
     {
       source: '/:path*',
       headers: [
         {
           key: 'Content-Security-Policy',
           value: "default-src 'self'; script-src 'self' 'unsafe-eval' 'unsafe-inline'; style-src 'self' 'unsafe-inline';",
         },
       ],
     },
   ],
   ```

2. ‚úÖ **CSRF —Ç–æ–∫–µ–Ω—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π**
   - –î–æ–±–∞–≤–∏—Ç—å –¥–ª—è POST/PUT/DELETE –æ–ø–µ—Ä–∞—Ü–∏–π
   - –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
   - –ü—Ä–æ–≤–µ—Ä—è—Ç—å –≤ API routes

3. ‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏**
   - –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ 401 –æ—à–∏–±–∫–∏
   - –ë—ã—Å—Ç—Ä–∞—è —Å–º–µ–Ω–∞ IP –∞–¥—Ä–µ—Å–æ–≤
   - –ò–∑–º–µ–Ω–µ–Ω–∏—è —Ä–æ–ª–µ–π

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (–£–ª—É—á—à–µ–Ω–∏—è)

1. ‚úÖ **–£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫**
   - –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç –æ—à–∏–±–æ–∫
   - –î–æ–±–∞–≤–∏—Ç—å error codes –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞

2. ‚úÖ **–î–æ–±–∞–≤–∏—Ç—å CAPTCHA –¥–ª—è auth endpoints**
   - –ü–æ—Å–ª–µ N –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
   - –ó–∞—â–∏—Ç–∞ –æ—Ç –±–æ—Ç–æ–≤

---

## ‚úÖ –ß–¢–û –†–ï–ê–õ–ò–ó–û–í–ê–ù–û –•–û–†–û–®–û

1. ‚úÖ **HTTP-only cookies** - –∑–∞—â–∏—Ç–∞ –æ—Ç XSS
2. ‚úÖ **SameSite=strict** - –∑–∞—â–∏—Ç–∞ –æ—Ç CSRF
3. ‚úÖ **–ö–æ—Ä–æ—Ç–∫–∏–π TTL access token** - 15 –º–∏–Ω—É—Ç
4. ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π refresh flow** - –ø—Ä–æ–∑—Ä–∞—á–Ω–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
5. ‚úÖ **–†–æ—Ç–∞—Ü–∏—è refresh —Ç–æ–∫–µ–Ω–∞** - –≤–∫–ª—é—á–µ–Ω–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
6. ‚úÖ **–î–≤–æ–π–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–µ–π** - middleware + API route
7. ‚úÖ **Refresh —Ç–æ–∫–µ–Ω—ã –≤ –ë–î** - –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∑—ã–≤–∞
8. ‚úÖ **–ó–∞—â–∏—Ç–∞ –æ—Ç user enumeration** - –≤—Å–µ–≥–¥–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –æ—Ç–≤–µ—Ç
9. ‚úÖ **Timing attack –∑–∞—â–∏—Ç–∞** - –±–∞–∑–æ–≤–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
10. ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ Zod** - —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
11. ‚úÖ **–û—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–µ–∫—à–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è

---

## üìù –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:** ‚úÖ **85/100** (–•–æ—Ä–æ—à–æ)

### –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ (HTTP-only cookies)
- ‚úÖ –ö–æ—Ä–æ—Ç–∫–∏–π TTL access token —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º refresh
- ‚úÖ Refresh —Ç–æ–∫–µ–Ω—ã —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –æ—Ç–∑—ã–≤–∞ –∏ —Ä–æ—Ç–∞—Ü–∏–∏
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–µ–π –Ω–∞ backend (middleware + API)
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç user enumeration
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π refresh flow —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### –û–±–ª–∞—Å—Ç–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è:
- ‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∞—É–¥–∏—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚ö†Ô∏è Rate limiting –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–Ω–µ—à–Ω–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
- ‚ö†Ô∏è –ù–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:
–°–∏—Å—Ç–µ–º–∞ **–≥–æ—Ç–æ–≤–∞ –∫ production** —Å —É—á–µ—Ç–æ–º —Å–ª–µ–¥—É—é—â–∏—Ö —É–ª—É—á—à–µ–Ω–∏–π:
1. –î–æ–±–∞–≤–∏—Ç—å –∞—É–¥–∏—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (–≤–∞–∂–Ω–æ –¥–ª—è compliance)
2. –î–æ–±–∞–≤–∏—Ç—å in-memory rate limiter fallback
3. –î–æ–±–∞–≤–∏—Ç—å CSP headers –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∑–∞—â–∏—Ç—ã

**–ö—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ù–ï–¢.**

---

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**
1. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –∞—É–¥–∏—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ö–æ–¥–æ–≤/–≤—ã—Ö–æ–¥–æ–≤
2. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å in-memory rate limiter fallback
3. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å CSP headers
4. ‚ö†Ô∏è –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ CSRF —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
5. ‚ö†Ô∏è –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

