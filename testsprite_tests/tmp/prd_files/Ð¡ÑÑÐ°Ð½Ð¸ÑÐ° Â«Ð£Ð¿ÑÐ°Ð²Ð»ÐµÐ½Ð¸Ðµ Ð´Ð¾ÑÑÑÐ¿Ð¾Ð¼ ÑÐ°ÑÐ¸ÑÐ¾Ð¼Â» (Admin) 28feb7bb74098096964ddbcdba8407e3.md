# Страница «Управление доступом/тарифом» (Admin)

**Суть:** админ вручную **выдаёт** или **продлевает** доступ аккаунту на период. **Онлайн-оплат нет.**

## Связанные страницы

- [Авторизация и роли через Auth4App](../%D0%9E%D0%B1%D1%89%D0%B8%D0%B5%20%D0%BC%D0%B0%D1%82%D0%B5%D1%80%D0%B8%D0%B0%D0%BB%D1%8B%20290eb7bb740980b19402dc2a5e6ed9f2/%D0%90%D0%B2%D1%82%D0%BE%D1%80%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F%20%D0%B8%20%D1%80%D0%BE%D0%BB%D0%B8%20%D1%87%D0%B5%D1%80%D0%B5%D0%B7%20Auth4App%2028feb7bb740980da8361e4fec5f75a2a.md) — кто видит админ-панель.
- [Демо закончился](../%D0%A0%D0%B0%D0%B1%D0%BE%D1%82%D0%B0%20%D1%81%20%D0%B4%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82%D0%B0%D0%BC%D0%B8%20(User)%20290eb7bb7409804da0aed86f3433deb2/%D0%A1%D1%82%D1%80%D0%B0%D0%BD%D0%B8%D1%86%D0%B0%20%C2%AB%D0%94%D0%B5%D0%BC%D0%BE%20%D0%B7%D0%B0%D0%BA%D0%BE%D0%BD%D1%87%D0%B8%D0%BB%D1%81%D1%8F%C2%BB%20(User)%2028feb7bb740980168788f46a803fbc3f.md) — UX последствий отключения.
- [Страница с шаблонами](../%D0%9A%D0%B0%D1%82%D0%B0%D0%BB%D0%BE%D0%B3%20%D1%88%D0%B0%D0%B1%D0%BB%D0%BE%D0%BD%D0%BE%D0%B2%20(Admin)%20290eb7bb740980fbb1f9e84a8df0ee21/%D0%9A%D0%B0%D1%82%D0%B0%D0%BB%D0%BE%D0%B3%20%D1%88%D0%B0%D0%B1%D0%BB%D0%BE%D0%BD%D0%BE%D0%B2%20%E2%80%94%20%D0%90%D0%B4%D0%BC%D0%B8%D0%BD%20(Admin)%2028aeb7bb740980fcac13d4842d08e63d.md) — после выдачи доступа «Использовать» снова активна.

---

## Доступ и роли

- Доступен **исключительно роли Admin**.
- Пользователи (клиенты) сюда не попадают.

## Маршруты

- Список аккаунтов: `/admin/access`
- Карточка аккаунта: `/admin/access/:userId`

---

## Список аккаунтов `/admin/access`

- Таблица: **Почта** · **Статус** (`Активен до <дата>` / `Доступ истёк` / `Нет доступа`) · **Последнее изменение** · **Открыть**
- Кнопка: **Выдать доступ по e-mail** → модал `email` → открывает/создаёт карточку.

**Критерии:** колонки как выше; «Открыть» ведёт в карточку; модал создаёт/открывает карточку.

---

## Карточка аккаунта `/admin/access/:userId`

### Текущий статус

- `Активен до: <DATE>` / `Доступ истёк: <DATE>` / `Нет активного доступа`
- **Последнее изменение:** `<DATE, admin>`
- **Комментарий администратора (последний)** — если был.

### Форма «Выдать/продлить доступ»

- **Дата начала** (`start_date`) — по умолчанию сегодня (можно изменить)
- **Дата окончания** (`end_date`) — **обязательное**
- **Комментарий** (`admin_note`) — опционально
- Кнопки:
    - **Сохранить доступ** (primary)
    - **Отключить доступ** (secondary, если доступ активен)
    - **Назад**

### История (read-only)

- `ДД.ММ.ГГГГ HH:MM — действие — период <start>–<end> — admin — комментарий (если был)`

---

## Валидации

- Формат дат: `YYYY-MM-DD` (или `ДД.ММ.ГГГГ`, привести к ISO на бэке)
- `end_date >= start_date`, иначе ошибка: **«Дата окончания должна быть не раньше даты начала.»**
- «Отключить доступ» → модал подтверждения: пользователь **сразу** теряет возможность создавать новые документы.

---

## Поведение

- Нет тарифов/оплат — только период доступа.
- Сохранение:
    - Если доступа нет/истёк — **создать** период `[start_date, end_date]`.
    - Если активен — **переписать/продлить** период.
- Отключение — установить `end_date = сейчас`.
- Клиентский продукт:
    - `сегодня > end_date` → экран «Демо закончился», создание документов заблокировано.
    - `сегодня ≤ end_date` → полный доступ.

---

## Модель (пример)

**Запрос (save):**

```json
{
  "userId": "uuid",
  "start_date": "2025-10-17",
  "end_date": "2026-01-17",
  "admin_note": "Продление до конца квартала"
}

```

**Ответ:**

```json
{
  "userId": "uuid",
  "email": "user@company.ru",
  "current_access": {
    "status": "active",
    "start_date": "2025-10-17",
    "end_date": "2026-01-17",
    "updated_at": "2025-10-17T12:34:56Z",
    "updated_by": "admin@our.app",
    "admin_note": "Продление до конца квартала"
  },
  "history": [
    {
      "at": "2025-10-17T12:34:56Z",
      "action": "grant_or_extend",
      "start_date": "2025-10-17",
      "end_date": "2026-01-17",
      "by": "admin@our.app",
      "note": "Продление до конца квартала"
    }
  ]
}

```

---

## Тексты (UI)

- **Сохранить доступ** · **Отключить доступ** · **Назад к списку**
- **Активен до:** `<дата>` · **Доступ истёк:** `<дата>` · **Нет активного доступа`
- Ошибка: **«Дата окончания должна быть не раньше даты начала.»**
- Модал отключения:
    - Заголовок: «Отключить доступ сейчас?»
    - Текст: «Пользователь сразу потеряет возможность создавать новые документы. Продолжить?»
    - Кнопки: «Отключить», «Отмена»

---

## Критерии приёмки

1. Экран доступен только Admin.
2. Admin может выдать/продлить/отключить доступ; изменения видны в истории.
3. Неверные даты блокируют сохранение с корректным сообщением.
4. Клиент теряет доступ к созданию документов сразу после отключения.