# Страница «Создать шаблон» (Admin)

**Прототип контекста каталога:**

[https://same-7reptl57dew-latest.netlify.app/templates/create](https://same-7reptl57dew-latest.netlify.app/templates/create)

---

## Назначение

Админ-форма для создания нового шаблона: **название, системное имя (code), пояснение, категория, теги, флаг `hasBodyChat`, статус `isEnabled`, имя первой версии**. После сохранения шаблон попадает в каталог (если включён).

## Связанные страницы

- [Список категорий](../%D0%9A%D0%B0%D1%82%D0%B0%D0%BB%D0%BE%D0%B3%20%D1%88%D0%B0%D0%B1%D0%BB%D0%BE%D0%BD%D0%BE%D0%B2%20(Admin)%20290eb7bb740980fbb1f9e84a8df0ee21/%D0%A1%D0%BF%D0%B8%D1%81%D0%BE%D0%BA%20%D0%BA%D0%B0%D1%82%D0%B5%D0%B3%D0%BE%D1%80%D0%B8%D0%B9%2028aeb7bb740980a48cb7dc0ba52ccfbc.md) / [Список тегов](../%D0%9A%D0%B0%D1%82%D0%B0%D0%BB%D0%BE%D0%B3%20%D1%88%D0%B0%D0%B1%D0%BB%D0%BE%D0%BD%D0%BE%D0%B2%20(Admin)%20290eb7bb740980fbb1f9e84a8df0ee21/%D0%A1%D0%BF%D0%B8%D1%81%D0%BE%D0%BA%20%D1%82%D0%B5%D0%B3%D0%BE%D0%B2%2028aeb7bb74098018b764ea8adfa1f5c5.md) — справочники выбора.
- [Просмотр шаблона (Admin)](%D0%A1%D1%82%D1%80%D0%B0%D0%BD%D0%B8%D1%86%D0%B0%20%C2%AB%D0%9F%D1%80%D0%BE%D1%81%D0%BC%D0%BE%D1%82%D1%80%20%D1%88%D0%B0%D0%B1%D0%BB%D0%BE%D0%BD%D0%B0%C2%BB%20(Admin)%20%E2%80%94%20%D1%82%D0%BE%D0%BB%D1%8C%D0%BA%D0%BE%20%D0%BF%D1%80%D0%BE%D1%81%D0%BC%2028aeb7bb740980568c4adfd4375306cf.md) — пост-редирект и публикация.
- [Реквизиты шаблона (Admin)](%D0%A1%D1%82%D1%80%D0%B0%D0%BD%D0%B8%D1%86%D0%B0%20%C2%AB%D0%A0%D0%B5%D0%BA%D0%B2%D0%B8%D0%B7%D0%B8%D1%82%D1%8B%20%D1%88%D0%B0%D0%B1%D0%BB%D0%BE%D0%BD%D0%B0%C2%BB%20(Admin)%2028aeb7bb740980259c6bc2f927c441ac.md) — отметить нужные поля для автоподстановки.
- [Как работает автоподстановка…](%D0%9A%D0%B0%D0%BA%20%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%B0%D0%B5%D1%82%20%D0%B0%D0%B2%D1%82%D0%BE%D0%BF%D0%BE%D0%B4%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0%20%D0%BF%D1%80%D0%B8%20%D0%9D%D0%9E%D0%92%D0%9E%D0%99%20%D0%B2%D0%B5%D1%80%D1%81%D0%B8%D0%B8%20%D1%88%D0%B0%D0%B1%D0%BB%2028aeb7bb74098065891bc846b53aff14.md) — влияние новой версии и списка реквизитов.

---

## Доступ

- Страница доступна **только админу**. Пользователь её не видит.

---

## Макет страницы

- Заголовок: **«Создать шаблон»**.
- Форма в два столбца (desktop):
    - **Левая колонка — Основные поля** (обязательные).
    - **Правая колонка — Публикация и версия**.
- **Предпросмотр карточки — удалён**.

---

## Поля формы и валидации

### Левая колонка — Основные поля

1. **Название (RU)** — текст, 5–50 символов, *обязательное*.
2. **Название в системе (code)** — `snake_case`, латиница/цифры/`_`, 3–40 символов, **уникально**, *обязательное*. Автогенерация из «Название (RU)» с ручной правкой.
3. **Короткое пояснение** — многострочный текст 20–100 символов, «зачем нужен документ», без упоминания подписания, *обязательное*.
4. **Категория** — select из базы «Категории», ровно 1 значение, *обязательное*.
5. **Теги** — multi-select из базы «Теги», минимум 1 тег, *обязательное*.
    - **Отображение в каталоге:** показываем **до 5 тегов** (в порядке, сохранённом у шаблона). Задать больше, чем 5 тегов **НЕЛЬЗЯ.**
6. **Тело через чат с ИИ (`hasBodyChat`)** — переключатель Да/Нет, *обязательное*.
    - Да → при выборе в каталоге переход на экран «Тело документа — чат» (реквизиты в ИИ **не отправляются**).
    - Нет → переход на «Привязку реквизитов».
7. **Статус доступности (`isEnabled`)** — переключатель Вкл/Выкл, *обязательное*. По умолчанию — Выкл.

### Правая колонка — Публикация и версия

1. **Имя первой версии (`version`)** — текст, SemVer-формат `vMAJOR.MINOR[.PATCH]`, по умолчанию `v1.0`, *обязательное*.

---

## Логика и поведение

- **Категории/теги** берутся только из Notion-справочников. Если нужного значения нет — добавить в справочник, затем выбрать в форме.
- **Порядок тегов сохраняется** и влияет на вывод в каталоге (первые **пять** отображаются на карточке).
- **Уникальность `code`** проверяется на блюре и при сабмите.
- **Сабмит**: кнопка **«Сохранить»** → при успехе редирект на страницу просмотра шаблона в админке (read-only) с подсказкой включить в каталог.
- **Отмена**: кнопка «Отмена» → возврат в каталог админа.
- Ошибки валидируются inline + глобальный тост при сетевых ошибках.

**Короткое примечание для разработчиков**

> Форма реквизитов на шаге создания документа генерируется из назначенных админом полей текущей опубликованной версии шаблона.
> 
> 
> Значения для этих полей, если есть в выбранной организации, **подтягиваются автоматически**.
> 

---

## Панель действий

- **Сохранить** (primary)
- **Отмена** (secondary)

---

## Модель для бэкенда (пример)

```json
{
  "code": "act_services",
  "name": "Акт выполненных работ / оказанных услуг",
  "shortDescription": "Подтверждает факт и объём оказанных услуг или выполненных работ, служит базой для расчётов.",
  "category": "primary_documents",
  "tags": ["services_works","contractor","customer"],
  "hasBodyChat": true,
  "isEnabled": false,
  "version": "v1.0"
}

```

> category и tags[] — слуги из справочников Notion; порядок tags[] важен для отображения до 5 тегов на карточке.
> 

---

## Критерии приёмки (QA)

1. Все обязательные поля заполнены — «Сохранить» активно.
2. `code` соответствует формату и уникален.
3. Выбрана ровно 1 категория и ≥1 тег из справочников.
4. `hasBodyChat` корректно определяет маршрут в каталоге (Чат/Реквизиты).
5. `version` по умолчанию `v1.0`, принимает корректные SemVer.
6. После сохранения — редирект на просмотр шаблона в админке.
7. В каталоге у карточки отображается **до 5 тегов** (без предпросмотра на странице создания).
8. Более 5 тегов добавить **НЕЛЬЗЯ**
9. Сохранения в черновик **НЕТ**
10. Отключённый шаблон (`isEnabled=false`) не виден пользователям; при включении появляется в каталоге.