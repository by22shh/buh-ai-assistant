# Страница «Редактировать организацию» (User)

## Связанные страницы

- [JSON-shema](../%D0%A0%D0%B5%D0%BA%D0%B2%D0%B8%D0%B7%D0%B8%D1%82%D1%8B%20%D0%B8%20%D1%81%D1%82%D1%80%D1%83%D0%BA%D1%82%D1%83%D1%80%D0%B0%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85%20290eb7bb7409800cb033fe6f585d9f78/JSON-shema%2028aeb7bb740980ae995ff9b5c20b86de.md) — валидность изменений.
- [Просмотр организации (read-only)](%D0%A1%D1%82%D1%80%D0%B0%D0%BD%D0%B8%D1%86%D0%B0%20%C2%AB%D0%9F%D1%80%D0%BE%D1%81%D0%BC%D0%BE%D1%82%D1%80%20%D0%BE%D1%80%D0%B3%D0%B0%D0%BD%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D0%B8%C2%BB%20(User)%20%E2%80%94%20read-only%2028aeb7bb74098067a589c69fdb72bc04.md) — пост-редирект после сохранения.
- [Мои организации](%D0%A1%D1%82%D1%80%D0%B0%D0%BD%D0%B8%D1%86%D0%B0%20%C2%AB%D0%9C%D0%BE%D0%B8%20%D0%BE%D1%80%D0%B3%D0%B0%D0%BD%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D0%B8%C2%BB%20(User)%2028aeb7bb7409803fbd3dc34a6f1e5dec.md) — метка «по умолчанию» видна в списке.
- [Заполнение реквизитов](../%D0%A0%D0%B0%D0%B1%D0%BE%D1%82%D0%B0%20%D1%81%20%D0%B4%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82%D0%B0%D0%BC%D0%B8%20(User)%20290eb7bb7409804da0aed86f3433deb2/%D0%A1%D1%82%D1%80%D0%B0%D0%BD%D0%B8%D1%86%D0%B0%20%C2%AB%D0%97%D0%B0%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5%20%D1%80%D0%B5%D0%BA%D0%B2%D0%B8%D0%B7%D0%B8%D1%82%D0%BE%D0%B2%C2%BB%20(User)%2028feb7bb7409809eac65ca6a6512831e.md) — актуальные данные подтянутся в новые документы.

---

## Назначение

Экран для **правки реквизитов уже созданной организации**. Пользователь может иметь несколько организаций и менять их данные, а также переключать, какая организация считается **«по умолчанию»** для автозаполнения документов.

> Состав полей, их обязательность, форматы и кросс-валидации не дублируются здесь — см. «Поля реквизитов» и JSON-schema по ссылкам выше.
> 

---

## Доступ и роли

- Доступна **только пользователю** (не админская форма).
- Пользователь редактирует **только свои** организации.
- Переключатель **«Сделать по умолчанию»** доступен в форме редактирования.

---

## Маршрутизация

- Профиль → Организации → карточка организации → **Редактировать**.
- Из просмотра организации: кнопка **Редактировать**.
- После сохранения:
    - редирект на **просмотр организации** (read-only) с уведомлением «Изменения сохранены»;
    - если редактирование вызвано из мастера создания документа, возврат в мастер с актуализированными реквизитами.

---

## Макет (desktop)

**Единая колонка** с группировкой полей, без отдельной правой колонки.

### Верхняя панель (над формой)

- Заголовок: **Редактировать организацию**
- Справа:
    - чекбокс **Сделать по умолчанию** (`is_default`)
    - кнопки: **Сохранить** (primary) / **Отмена** (secondary)

### Группы полей (одна колонка)

1. **Общие данные** — `name_full`, `name_short`, `subject_type`
2. **Идентификаторы** — `inn`, `kpp` (для юрлица), `ogrn`/`ogrnip`, опц. `okpo`, `okved`
3. **Адреса и контакты** — `address_legal`, опц. `address_postal` (+ чекбокс «совпадает»), `phone`, `email`, опц. `website`
4. **Руководитель и полномочия** — `head_title`, `head_fio`, `authority_base` (+ при «Доверенности»: `poa_number`, `poa_date`)
5. **Банковские реквизиты** — `bank_bik`, `bank_name`, `bank_ks`, `bank_rs`
6. **Дополнительно (опционально)** — `seal_note`, `notes`

> Форматы/обязательность/зависимости — строго по JSON-schema.
> 

---

## Поведение и валидация

- **Inline-валидация** под полем после blur и при submit. Глобальный тост при сетевой ошибке.
- **Кросс-логика** (без дубляжа деталей):
    - Зависимость от `subject_type` (юрлицо/ИП) — состав обязательных полей и длины `inn`, набор `ogrn`/`ogrnip`, видимость `kpp`.
    - `authority_base = "Доверенности"` → обязательны `poa_number`, `poa_date`.
    - Контрольные суммы: `inn`, `ogrn`, `ogrnip`.
    - Проверки БИК ↔ `bank_ks`/`bank_rs` по контрольной строке (веса `[7,1,3]`).
- **Нормализация** (перед отправкой и на сервере):
    - trim + схлопывание пробелов во всех строковых полях;
    - телефон хранится строго в формате `+7XXXXXXXXXX` (ввод `8…` допускается и конвертируется);
    - «Почтовый адрес совпадает» — копирует `address_legal`.
- **Смена `subject_type`**:
    - При переключении юрлицо ↔ ИП UI **перестраивает** обязательные поля и очищает несовместимые (например, при переходе на ИП скрыть/очистить `kpp`, `ogrn`; при переходе на юрлицо скрыть/очистить `ogrnip`).
    - Сабмит заблокирован, пока обязательные поля для нового типа не заполнены и не валидны.

---

## «Сделать по умолчанию»

- Чекбокс `is_default` доступен прямо на экране редактирования.
- При включении — текущая организация помечается как дефолтная, предыдущая дефолтная снимается автоматически.
- Визуальная метка «По умолчанию» показывается в списке организаций и на странице просмотра.

---

## Состояния интерфейса

- **Загрузка данных**: поля предзаполнены текущими значениями организации.
- **Изменений нет**: кнопка «Сохранить» неактивна (опционально) или активна, но сервер вернёт 204/«без изменений».
- **Ошибки**: inline-сообщения + общий тост при ошибке сохранения.
- **Успех**: тост «Изменения сохранены» + редирект (см. «Маршрутизация»).

---

## Критерии приёмки (QA)

1. Состав обязательных полей и их форматы соответствуют **JSON-schema** во всех состояниях (юрлицо/ИП, доверенность/устав).
2. При смене `subject_type` UI корректно обновляет видимость/обязательность полей и очищает несовместимые значения.
3. Контрольные суммы `inn`, `ogrn`, `ogrnip` и проверки БИК ↔ `bank_ks`/`bank_rs` отрабатывают корректно.
4. Телефон сохраняется в формате `+7…`, адресные поля проходят синтаксические проверки.
5. Чекбокс **«Сделать по умолчанию»** переключает дефолтную организацию пользователя.
6. После успешного сохранения — тост «Изменения сохранены» и редирект на просмотр организации (или возврат в мастер, если редактирование было вызвано из него).
7. Серверная валидация дублирует клиентскую; некорректные данные не попадают в хранилище.

---

## Нефункциональные требования (кратко)

- Производительность: рендер формы ≤ 1 c, сабмит ≤ 1 c.
- Безопасность: вся передача по HTTPS; серверная повторная валидация по **JSON-schema**.
- Логи: фиксируются факты изменения полей (без сохранения полных значений чувствительных реквизитов в логах).

---

### Ссылки

- **Поля реквизитов:** [https://www.notion.so/28aeb7bb74098001a86eef46f1ae7bee](../%D0%A0%D0%B5%D0%BA%D0%B2%D0%B8%D0%B7%D0%B8%D1%82%D1%8B%20%D0%B8%20%D1%81%D1%82%D1%80%D1%83%D0%BA%D1%82%D1%83%D1%80%D0%B0%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85%20290eb7bb7409800cb033fe6f585d9f78/%D0%9F%D0%BE%D0%BB%D1%8F%20%D1%80%D0%B5%D0%BA%D0%B2%D0%B8%D0%B7%D0%B8%D1%82%D0%BE%D0%B2%2028aeb7bb74098001a86eef46f1ae7bee.md)
- **JSON-schema:** [https://www.notion.so/JSON-shema-28aeb7bb740980ae995ff9b5c20b86de](../%D0%A0%D0%B5%D0%BA%D0%B2%D0%B8%D0%B7%D0%B8%D1%82%D1%8B%20%D0%B8%20%D1%81%D1%82%D1%80%D1%83%D0%BA%D1%82%D1%83%D1%80%D0%B0%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85%20290eb7bb7409800cb033fe6f585d9f78/JSON-shema%2028aeb7bb740980ae995ff9b5c20b86de.md)