# Страница «Редактирование шаблона» (Admin)

**URL (пример):**

[https://same-7reptl57dew-latest.netlify.app/templates/edit/employment-contract](https://same-7reptl57dew-latest.netlify.app/templates/edit/employment-contract)

---

## Связанные страницы

- [Создать шаблон (Admin)](%D0%A1%D1%82%D1%80%D0%B0%D0%BD%D0%B8%D1%86%D0%B0%20%C2%AB%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D1%82%D1%8C%20%D1%88%D0%B0%D0%B1%D0%BB%D0%BE%D0%BD%C2%BB%20(Admin)%2028aeb7bb74098075a5fdf2b80513bc23.md) — поля/валидации как референс.
- [Просмотр шаблона (Admin)](%D0%A1%D1%82%D1%80%D0%B0%D0%BD%D0%B8%D1%86%D0%B0%20%C2%AB%D0%9F%D1%80%D0%BE%D1%81%D0%BC%D0%BE%D1%82%D1%80%20%D1%88%D0%B0%D0%B1%D0%BB%D0%BE%D0%BD%D0%B0%C2%BB%20(Admin)%20%E2%80%94%20%D1%82%D0%BE%D0%BB%D1%8C%D0%BA%D0%BE%20%D0%BF%D1%80%D0%BE%D1%81%D0%BC%2028aeb7bb740980568c4adfd4375306cf.md) — публикация/депубликация после правок.
- [Реквизиты шаблона (Admin)](%D0%A1%D1%82%D1%80%D0%B0%D0%BD%D0%B8%D1%86%D0%B0%20%C2%AB%D0%A0%D0%B5%D0%BA%D0%B2%D0%B8%D0%B7%D0%B8%D1%82%D1%8B%20%D1%88%D0%B0%D0%B1%D0%BB%D0%BE%D0%BD%D0%B0%C2%BB%20(Admin)%2028aeb7bb740980259c6bc2f927c441ac.md) — поддержать список требуемых реквизитов.
- [Как работает автоподстановка…](%D0%9A%D0%B0%D0%BA%20%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%B0%D0%B5%D1%82%20%D0%B0%D0%B2%D1%82%D0%BE%D0%BF%D0%BE%D0%B4%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0%20%D0%BF%D1%80%D0%B8%20%D0%9D%D0%9E%D0%92%D0%9E%D0%99%20%D0%B2%D0%B5%D1%80%D1%81%D0%B8%D0%B8%20%D1%88%D0%B0%D0%B1%D0%BB%2028aeb7bb74098065891bc846b53aff14.md) — последствия смены версии docx для новых документов.

## Назначение

Экран для администратора, где он **редактирует атрибуты** шаблона и **управляет версиями docx**. Публикация/снятие с публикации выполняются **на странице просмотра**, а не здесь (read-only пометка и ссылка на просмотр).

**Принципы версий:**

- Новая загруженная версия docx становится **активной для всех новых документов**, но **не ломает ранее созданные** (они остаются на своей версии).
- Публикация (`isEnabled`) управляется на **Просмотре**; на «Редактировании» нет кнопок публикации.

---

## Доступ

Только **админ** (пользователь не видит/не имеет доступа).

---

## Макет (desktop)

**Хедер**

- Название (RU) — контекст (editable).
- Текущая версия (бейдж, read-only).
- Статус публикации (read-only подсказка с ссылкой «Открыть просмотр (публикация)»).

**Тело — 2 колонки**

- **Левая:** атрибуты шаблона (редактируемые).
- **Правая:** версионирование docx + системные поля (`code`, текущая `version` — read-only).

**Низ страницы — Панель действий**

- **Сохранить изменения** (primary) / **Отменить** (secondary) / **Открыть просмотр (публикация)** (link).

---

## Поля и правила

### Левая колонка — атрибуты

1. **Название (RU)** — 5–50 символов, обязательно. (Аналогично «Создать».)
2. **Короткое пояснение** — 20–100 символов, «зачем нужен документ», без упоминания подписания, обязательно.
3. **Категория** — select **ровно 1** значение из справочника «Категории», обязательно.
4. **Теги** — multi-select из «Теги», **1–5** значений, порядок сохраняется и влияет на показ (в карточке показываем до 5).
5. **Тело через чат с ИИ (`hasBodyChat`)** — Да/Нет, обязательно; определяет маршрут:
    
    — Да → экран «Тело документа — чат» (реквизиты в ИИ **не отправляются**)
    
    — Нет → «Привязка реквизитов».
    

> Все значения категорий/тегов строго из справочников (если нет — сперва добавить в справочник, затем выбрать).
> 

### Правая колонка — версионирование docx и системные поля

1. **Системное имя (`code`)** — **read-only** (не редактируется после создания).
2. **Текущая версия (`version`)** — **read-only** (показываем актуальную). Публикация — на экране Просмотра.
3. **Загрузить новую версию docx** — загрузчик `.docx` с валидациями:
    - формат `.docx`, размер ≤ 15 МБ;
    - проверка плейсхолдеров по словарю (unknown → блокирующая ошибка);
    - указать **имя версии** в SemVer (`vMAJOR.MINOR[.PATCH]`, например `v1.1`).
        
        При успешной фиксации: новая версия становится **активной для новых документов**, существующие не мигрируют. (Правило совместимости версий — см. «Назначение» выше.)
        

---

## Поведение и валидации

- Все обязательные поля должны быть заполнены — иначе «Сохранить» неактивна. (Правило как на «Создать».)
- `code` не редактируется (read-only).
- **Не более 5 тегов**; порядок тегов сохраняем (влияет на карточку каталога, где показываем до 5 тегов).
- `hasBodyChat` определяет роутинг при выборе шаблона пользователем (чётко описано в каталоге).
- Загрузка новой версии требует валидного SemVer и успешной проверки docx/плейсхолдеров; по успеху — тост «Версия сохранена. Новые документы создаются по новой версии».

---

## Интеграция с каталогом и просмотром

- В **каталоге** карточки показывают **до 5 тегов**, «Популярное» отсутствует, фильтры: **категория (одна)** и **теги (AND-логика)**; поиск по названию/пояснению/тегам (RU-названия тегов).
- Кнопки публикации/депубликации находятся **на странице Просмотра**, не в «Редактировании».

---

## Критерии приёмки (QA)

1. Доступен только админу; пользователь не может открыть страницу.
2. Редактируются: Название, Пояснение, Категория (ровно 1), Теги (1–5, порядок сохраняется), `hasBodyChat`. `code` и текущая `version` — read-only.
3. При сохранении атрибутов они применяются для каталога; маршрут выбора нового документа зависит от `hasBodyChat`.
4. Загрузка новой версии docx: только `.docx`, лимит размера, проверка плейсхолдеров; требует SemVer; после фиксации новая версия активна только для **новых** документов.
5. На странице нет управления публикацией; ссылка ведёт на «Просмотр», где есть **Опубликовать/Снять с публикации** с блокирующими проверками.

---

### Что именно было синхронизировано с источниками правды

- **До 5 тегов в карточке, без «Подробнее»**, AND-фильтр по тегам, удалён раздел «Популярное».
- **Маршрутизация от `hasBodyChat`** (чат тела документа vs. привязка реквизитов) — строго по правилам каталога.
- **Публикация/депубликация** — только на **Просмотре**; «Редактирование» — без этих действий.
- **Обязательные поля/валидации** и формат **SemVer** — по «Создать шаблон».