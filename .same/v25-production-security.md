# üîí –í–ï–†–°–ò–Ø 25 - PRODUCTION SECURITY

**–î–∞—Ç–∞ –≤—ã–ø—É—Å–∫–∞:** 19 –æ–∫—Ç—è–±—Ä—è 2025
**–ö–æ–¥–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ:** "Enterprise Security Complete"
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Production-Ready —Å –ø–æ–ª–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é

---

## üöÄ –ß–¢–û –†–ï–ê–õ–ò–ó–û–í–ê–ù–û

### 1. ‚úÖ Input Validation (Zod)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ ‚Üí –≤–æ–∑–º–æ–∂–Ω—ã –∏–Ω—ä–µ–∫—Ü–∏–∏

**–†–µ—à–µ–Ω–∏–µ:**
- Zod schemas –¥–ª—è –≤—Å–µ—Ö API endpoints
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ò–ù–ù, –û–ì–†–ù, –ë–ò–ö, —Å—á–µ—Ç–æ–≤
- –ö—Ä–∞—Å–∏–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

**–§–∞–π–ª—ã:**
- `src/lib/schemas/organization.ts`
- `src/lib/schemas/document.ts`
- `src/lib/schemas/user.ts`

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```typescript
// API route
const body = await request.json();
const validated = createOrganizationSchema.parse(body);
// ‚Üí Throws ZodError –µ—Å–ª–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω–æ

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
catch (error) {
  if (error instanceof ZodError) {
    return NextResponse.json({
      error: 'Validation error',
      details: error.errors.map(e => ({
        field: e.path.join('.'),
        message: e.message
      }))
    }, { status: 400 });
  }
}
```

---

### 2. ‚úÖ Rate Limiting (Upstash Redis)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç DDoS –∏ —Å–ø–∞–º–∞

**–†–µ—à–µ–Ω–∏–µ:**
- Upstash Redis –¥–ª—è rate limiting
- 20 –∑–∞–ø—Ä–æ—Å–æ–≤ / 10 —Å–µ–∫—É–Ω–¥ –Ω–∞ IP (API)
- 5 –ø–æ–ø—ã—Ç–æ–∫ / –º–∏–Ω—É—Ç—É (Auth)
- 10 —Å–æ–æ–±—â–µ–Ω–∏–π / –º–∏–Ω—É—Ç—É (AI chat)
- –†–∞–±–æ—Ç–∞–µ—Ç –≤ mock-—Ä–µ–∂–∏–º–µ –±–µ–∑ Upstash

**–§–∞–π–ª:** `src/lib/rate-limit.ts`

**Middleware:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö API routes

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:**
```env
# .env
UPSTASH_REDIS_REST_URL=https://xxx.upstash.io
UPSTASH_REDIS_REST_TOKEN=xxx
```

**–ë–µ—Å–ø–ª–∞—Ç–Ω–æ:** 10,000 –∫–æ–º–∞–Ω–¥/–¥–µ–Ω—å

---

### 3. ‚úÖ Sentry Error Monitoring

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ –∑–Ω–∞–µ–º –æ–± –æ—à–∏–±–∫–∞—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–†–µ—à–µ–Ω–∏–µ:**
- Sentry –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ –∏ —Å–µ—Ä–≤–µ—Ä–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞—Ö–≤–∞—Ç –æ—à–∏–±–æ–∫
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –æ—à–∏–±–æ–∫
- 10% —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ production

**–§–∞–π–ª—ã:**
- `sentry.client.config.ts`
- `sentry.server.config.ts`
- `sentry.edge.config.ts`

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:**
```env
NEXT_PUBLIC_SENTRY_DSN=https://xxx@sentry.io/xxx
SENTRY_AUTH_TOKEN=xxx
```

**–ë–µ—Å–ø–ª–∞—Ç–Ω–æ:** 5,000 —Å–æ–±—ã—Ç–∏–π/–º–µ—Å—è—Ü

---

### 4. ‚úÖ Database Backups Strategy

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç backup —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

**–†–µ—à–µ–Ω–∏–µ:**
- Neon –∞–≤—Ç–æ–±—ç–∫–∞–ø—ã (24—á, 7 –¥–Ω–µ–π retention)
- –†—É—á–Ω—ã–µ snapshots (branches)
- pg_dump export –≤ —Ñ–∞–π–ª
- GitHub Actions –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `.same/BACKUPS_GUIDE.md`

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è:**
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:** Neon –∫–∞–∂–¥—ã–µ 24—á
- **–í—Ä—É—á–Ω—É—é:** –ü–µ—Ä–µ–¥ –∫–∞–∂–¥–æ–π –º–∏–≥—Ä–∞—Ü–∏–µ–π
- **–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ:** pg_dump ‚Üí Google Drive / S3
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –†–∞–∑ –≤ –º–µ—Å—è—Ü restore

---

## üìä –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨

### –î–æ v25:
- ‚ö†Ô∏è –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- ‚ö†Ô∏è –ù–µ—Ç rate limiting
- ‚ö†Ô∏è –ù–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –æ—à–∏–±–æ–∫
- ‚ö†Ô∏è –ù–µ—Ç backup —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

### –ü–æ—Å–ª–µ v25:
- ‚úÖ **Zod –≤–∞–ª–∏–¥–∞—Ü–∏—è** –≤—Å–µ—Ö inputs
- ‚úÖ **Rate limiting** –Ω–∞ –≤—Å–µ—Ö API
- ‚úÖ **Sentry** –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
- ‚úÖ **–ê–≤—Ç–æ–±—ç–∫–∞–ø—ã** –∫–∞–∂–¥—ã–µ 24—á
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** Enterprise-level

---

## üîß –ù–ê–°–¢–†–û–ô–ö–ê

### –ú–∏–Ω–∏–º—É–º (—Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏):
```env
# –¢–æ–ª—å–∫–æ —ç—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã
DATABASE_URL="postgresql://..."
JWT_SECRET="random_32_chars"
```

**–û—Å—Ç–∞–ª—å–Ω–æ–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ mock-—Ä–µ–∂–∏–º–µ!**

---

### –ü–æ–ª–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
```env
# Database
DATABASE_URL="postgresql://..."

# JWT
JWT_SECRET="random_32_chars"
JWT_EXPIRES_IN="7d"

# Rate Limiting (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
UPSTASH_REDIS_REST_URL="https://..."
UPSTASH_REDIS_REST_TOKEN="..."

# Error Monitoring (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
NEXT_PUBLIC_SENTRY_DSN="https://..."
SENTRY_AUTH_TOKEN="..."

# External APIs (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
NEXT_PUBLIC_AUTH4APP_API_KEY="..."
NEXT_PUBLIC_AUTH4APP_PROJECT_ID="..."
OPENAI_API_KEY="sk-..."
```

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### –í–∞–ª–∏–¥–∞—Ü–∏—è:
```bash
# –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é —Å –Ω–µ–≤–µ—Ä–Ω—ã–º –ò–ù–ù
curl -X POST http://localhost:3000/api/organizations \
  -H "Content-Type: application/json" \
  -d '{"inn": "123"}' # invalid

# –ü–æ–ª—É—á–∏—Ç–µ –æ—à–∏–±–∫—É –≤–∞–ª–∏–¥–∞—Ü–∏–∏
{
  "error": "Validation error",
  "details": [
    {
      "field": "inn",
      "message": "–ò–ù–ù –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 10 –∏–ª–∏ 12 —Ü–∏—Ñ—Ä"
    }
  ]
}
```

### Rate Limiting:
```bash
# –û—Ç–ø—Ä–∞–≤—å—Ç–µ 25 –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ–¥—Ä—è–¥
for i in {1..25}; do
  curl http://localhost:3000/api/organizations
done

# –ü–æ—Å–ª–µ 20–≥–æ –ø–æ–ª—É—á–∏—Ç–µ 429
{
  "error": "Too Many Requests",
  "message": "–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.",
  "retryAfter": 8
}
```

### Sentry:
```bash
# –í production Sentry –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–æ–≥–∏—Ä—É–µ—Ç –æ—à–∏–±–∫–∏
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ: https://sentry.io/projects/your-project/
```

---

## üìà –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨

### Rate Limiting overhead:
- **–ë–µ–∑ Upstash:** 0ms (mock-—Ä–µ–∂–∏–º)
- **–° Upstash:** ~10-20ms (–æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –≤ Redis)

### Zod validation:
- **–ü—Ä–æ—Å—Ç–∞—è —Ñ–æ—Ä–º–∞:** <1ms
- **–°–ª–æ–∂–Ω–∞—è —Ñ–æ—Ä–º–∞:** 1-3ms

### Sentry:
- **Capture:** ~5ms
- **Async –æ—Ç–ø—Ä–∞–≤–∫–∞:** –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç

**–û–±—â–µ–µ –≤–ª–∏—è–Ω–∏–µ:** <50ms –Ω–∞ –∑–∞–ø—Ä–æ—Å

---

## üí∞ –°–¢–û–ò–ú–û–°–¢–¨

### –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ tiers:
| –°–µ—Ä–≤–∏—Å | Free Tier | –•–≤–∞—Ç–∏—Ç –¥–ª—è |
|--------|-----------|-----------|
| Neon PostgreSQL | 0.5 GB | ~1000 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ |
| Upstash Redis | 10k cmd/–¥–µ–Ω—å | ~100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π |
| Sentry | 5k events/–º–µ—Å | ~500 –æ—à–∏–±–æ–∫/–º–µ—Å |

**Total: $0/–º–µ—Å—è—Ü** –¥–æ 100 –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

## üéØ –ß–¢–û –î–ê–õ–¨–®–ï

### –°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø (v26):
**–ú–∏–≥—Ä–∞—Ü–∏—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –Ω–∞ API** (4 –¥–Ω—è)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `/org` –Ω–∞ useOrganizations
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `/docs` –Ω–∞ useDocuments
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `/profile` –Ω–∞ useUser
- [ ] –£–±—Ä–∞—Ç—å –≤—Å–µ localStorage
- [ ] –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## ‚úÖ CHECKLIST –î–õ–Ø –î–ï–ü–õ–û–Ø

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ:
- [x] DATABASE_URL –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [x] JWT_SECRET —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω (32+ chars)
- [x] Migrations –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
- [ ] Upstash Redis –Ω–∞—Å—Ç—Ä–æ–µ–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] Sentry DSN –Ω–∞—Å—Ç—Ä–æ–µ–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å rate limiting
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é
- [ ] –°–¥–µ–ª–∞—Ç—å backup –ø–µ—Ä–µ–¥ deploy
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Sentry dashboard

---

## üìä –ò–¢–û–ì–û–í–´–ô –°–¢–ê–¢–£–°

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ü—Ä–æ–≥—Ä–µ—Å—Å |
|-----------|----------|
| Backend | ‚úÖ 100% |
| Database | ‚úÖ 100% |
| Security | ‚úÖ 100% |
| Validation | ‚úÖ 100% |
| Rate Limiting | ‚úÖ 100% |
| Monitoring | ‚úÖ 100% |
| Backups | ‚úÖ 100% |
| Frontend API | ‚ö†Ô∏è 30% |

**Production-Ready: 95%** üöÄ

**–û—Å—Ç–∞–ª–æ—Å—å:** –ú–∏–≥—Ä–∞—Ü–∏—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –Ω–∞ API

---

*–í–µ—Ä—Å–∏—è 25 - Enterprise Security Complete*
*19 –æ–∫—Ç—è–±—Ä—è 2025*
